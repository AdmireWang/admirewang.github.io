<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>etcd介绍 | Go Docs</title>
    <meta name="description" content="Go Docs">
    <meta name="generator" content="VitePress v1.2.3">
    <link rel="preload stylesheet" href="/assets/style.6jWMGCsz.css" as="style">
    
    <script type="module" src="/assets/app.BNZWwQrl.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.rLRl8Q3O.js">
    <link rel="modulepreload" href="/assets/chunks/theme.N-pqxnmt.js">
    <link rel="modulepreload" href="/assets/Golang进阶_18_etcd介绍_README.md.DvD1AlY8.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar has-sidebar top" data-v-ae24b3ad data-v-ccf7ddec><div class="wrapper" data-v-ccf7ddec><div class="container" data-v-ccf7ddec><div class="title" data-v-ccf7ddec><div class="VPNavBarTitle has-sidebar" data-v-ccf7ddec data-v-ab179fa1><a class="title" href="/" data-v-ab179fa1><!--[--><!--]--><!----><span data-v-ab179fa1>Go Docs</span><!--[--><!--]--></a></div></div><div class="content" data-v-ccf7ddec><div class="content-body" data-v-ccf7ddec><!--[--><!--]--><div class="VPNavBarSearch search" data-v-ccf7ddec><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-ccf7ddec data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Golang%E5%9F%BA%E7%A1%80/01_Go%E8%AF%AD%E8%A8%80%E5%8F%91%E5%B1%95%E7%AE%80%E5%8F%B2/README.html" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>Golang基础</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Golang%E8%BF%9B%E9%98%B6/04_Golang%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/README.html" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>Golang进阶</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Gin%E6%A1%86%E6%9E%B6/1_Gin%E5%86%85%E5%AE%B9%E4%BB%8B%E7%BB%8D/README.html" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>Gin框架</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-ccf7ddec data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-e6aabb21 data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-ccf7ddec data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-ccf7ddec data-v-d0bd9dde data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b6c34ac9><span class="vpi-more-horizontal icon" data-v-b6c34ac9></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-d0bd9dde><div class="item appearance" data-v-d0bd9dde><p class="label" data-v-d0bd9dde>Appearance</p><div class="appearance-action" data-v-d0bd9dde><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-d0bd9dde data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div></div></div><div class="group" data-v-d0bd9dde><div class="item social-links" data-v-d0bd9dde><div class="VPSocialLinks social-links-list" data-v-d0bd9dde data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-ccf7ddec data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-ccf7ddec><div class="divider-line" data-v-ccf7ddec></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-17a5e62e><button data-v-17a5e62e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-575e6a36><div class="curtain" data-v-575e6a36></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-575e6a36><span class="visually-hidden" id="sidebar-aria-label" data-v-575e6a36> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>Golang进阶</h2><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/04_Golang%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>04_Golang并发编程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/05_%E4%BA%92%E8%81%94%E7%BD%91%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>05_互联网协议介绍</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/06_HTTP%E8%AF%B7%E6%B1%82/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>06_HTTP请求</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/07_%E6%97%A5%E5%BF%97%E5%BA%93/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>07_日志库</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/08_%E5%8F%8D%E5%B0%84/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>08_反射</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/09_%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>09_单元测试</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/10_Flag%E5%8C%85%E7%9A%84%E7%94%A8%E6%B3%95/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>10_Flag包的用法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/11_Go%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>11_Go操作数据库</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/12_sqlx%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>12_sqlx库的使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/13_Go%E6%93%8D%E4%BD%9CRedis/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>13_Go操作Redis</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/14_Go%E6%93%8D%E4%BD%9C%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>14_Go操作消息队列</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/15_Go%E7%9A%84%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86GoModule/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>15_Go的依赖管理GoModule</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/16_GoContext%E7%9A%84%E4%BD%BF%E7%94%A8/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>16_GoContext的使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/17_%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%8F%8AKafka%E4%BB%8B%E7%BB%8D/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>17_日志收集项目架构设计及Kafka介绍</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/18_etcd%E4%BB%8B%E7%BB%8D/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>18_etcd介绍</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/19_ES%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>19_ES介绍和使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/20_Kafka%E6%B6%88%E8%B4%B9%E7%A4%BA%E4%BE%8B/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>20_Kafka消费示例</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/21_Kibana%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>21_Kibana介绍和使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Golang%E8%BF%9B%E9%98%B6/22_Prometheus%E5%92%8CGrafana%E4%BB%8B%E7%BB%8D/README.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>22_Prometheus和Grafana介绍</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _Golang%E8%BF%9B%E9%98%B6_18_etcd%E4%BB%8B%E7%BB%8D_README" data-v-39a288b8><div><h1 id="etcd介绍" tabindex="-1">etcd介绍 <a class="header-anchor" href="#etcd介绍" aria-label="Permalink to &quot;etcd介绍&quot;">​</a></h1><h3 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-label="Permalink to &quot;前言&quot;">​</a></h3><p>etcd：目前比较火的开源库，docker和k8s都是使用的它</p><p>目标：使用etcd优化日志收集项目</p><h2 id="介绍" tabindex="-1">介绍 <a class="header-anchor" href="#介绍" aria-label="Permalink to &quot;介绍&quot;">​</a></h2><p>etcd是使用Go语言开发的一个开源的、高可用的分布式key-value存储系统，可以用于配置共享和服务的注册和发现，类似项目有Zookeeper和consul</p><p>etcd具有以下特点</p><ul><li>完全复制：集群中的每个节点都可以使用完整的存档</li><li>高可用性：Etcd可用于避免硬件的单点故障或网络问题（选择出另外的leader）</li><li>一致性：每次读取都会返回跨多主机的最新写入</li><li>简单：包括一个定义良好、面向用户的API（gRPC）</li><li>安全：实现了带有可选的客户端证书身份验证的自动化TLS</li><li>快速：每秒10000次写入的基准速度</li><li>可靠：使用 <strong>Raft</strong> 算法实现了强一致性，高可用的服务存储目录 <ul><li>Raft协议：选举、日志复制机制、异常处理（脑裂）、Zookeeper的zad协议的区别</li></ul></li></ul><h2 id="etcd应用场景" tabindex="-1">etcd应用场景 <a class="header-anchor" href="#etcd应用场景" aria-label="Permalink to &quot;etcd应用场景&quot;">​</a></h2><h3 id="服务发现" tabindex="-1">服务发现 <a class="header-anchor" href="#服务发现" aria-label="Permalink to &quot;服务发现&quot;">​</a></h3><p>服务发现要解决的也是分布式系统中最常见的问题之一，即在同一个分布式集群中的进程或服务，要如何才能找到对方并建立连接。本质上来说，服务发现就是想要了解集群中是否有进程在监听udp或tcp端口，并且通过名字就可以查找和连接。</p><p><img src="/assets/image-20200910161600037.gOF70htl.png" alt="image-20200910161600037"></p><h3 id="配置中心" tabindex="-1">配置中心 <a class="header-anchor" href="#配置中心" aria-label="Permalink to &quot;配置中心&quot;">​</a></h3><p>将一些配置信息放到etcd上进行集中管理。这类场景的使用方式通常是这样的：应用启动的时候，主动从etcd获取一次配置信息，同时，在etcd节点上注册一个Watcher并等待，以后每次配置有更新的时候，etcd都会实时通知订阅者，以此达到获取最新配置信息的目的。</p><h3 id="分布式锁" tabindex="-1">分布式锁 <a class="header-anchor" href="#分布式锁" aria-label="Permalink to &quot;分布式锁&quot;">​</a></h3><p>因为etcd使用Raft算法保持了数据的强一致性，某次操作存储到集群中的值必然是全局一致性的，所以很容易实现分布式锁。锁服务有两种使用方式，一种是保持独占，二是控制时序。</p><ul><li>保持独占即所有获取锁的用户最终只有一个可以得到。etcd为此提供了一套实现分布式锁原子操作CAS（CompareAndSwap）的API。通过设置preExist值，可以保证在多个节点同时去创建某个目录时，只有一个成功，而创建成功的用户就可以认为是获得了锁。</li><li>控制时序，即所有想要获得锁的用户都会被安排执行，但是获得锁的顺序也是全局唯一的，同时决定了执行顺序。etcd为此也提供了一套API（自动创建有序键），对一个目录建值时指定为POST动作，这样etcd会自动在目录下生成一个当前最大的键值。此时这些键的值就是客户端的时序，而这些键中的存储的值可以代表客户端的编号。</li></ul><p><img src="/assets/image-20200910212441132.B8uNWbVm.png" alt="image-20200910212441132"></p><p>上图就是三个同时来竞争锁，最后只有一个获取到了锁</p><h2 id="为什么使用etcd而不用zookeeper" tabindex="-1">为什么使用etcd而不用Zookeeper？ <a class="header-anchor" href="#为什么使用etcd而不用zookeeper" aria-label="Permalink to &quot;为什么使用etcd而不用Zookeeper？&quot;">​</a></h2><h3 id="zookeeper存在的问题" tabindex="-1">Zookeeper存在的问题 <a class="header-anchor" href="#zookeeper存在的问题" aria-label="Permalink to &quot;Zookeeper存在的问题&quot;">​</a></h3><p>etcd 实现的这些功能，ZooKeeper都能实现。那么为什么要用etcd 而非直接使用ZooKeeper呢？相较之下，ZooKeeper有如下缺点：</p><ul><li><strong>复杂</strong>：ZooKeeper的部署维护复杂，管理员需要掌握一系列的知识和技能；而Paxos 强一致性算法也是素来以复杂难懂而闻名于世；另外，ZooKeeper的使用也比较复杂，需要安装客户端，官方只提供了Java和C两种语言的接口。</li><li><strong>Java编写</strong>：这里不是对Java有偏见，而是Java本身就偏向于重型应用，它会引入大量的依赖。而运维人员则普遍希望保持强一致、高可用的机器集群尽可能简单，维护起来也不易出错。</li><li><strong>发展缓慢</strong>：Apache 基金会项目特有的&quot;Apache Way”在开源界饱受争议，其中一大原因就是由于基金会庞大的结构以及松散的管理导致项目发展缓慢。</li></ul><h3 id="etcd的优势" tabindex="-1">etcd的优势 <a class="header-anchor" href="#etcd的优势" aria-label="Permalink to &quot;etcd的优势&quot;">​</a></h3><p>而etcd作为一个后起之秀，其优点也很明显</p><p><strong>简单</strong>：使用Go语言编写部署简单；使用HTTP作为接口使用简单；使用Raft 算法保证强一致性让用户易于理解。</p><p><strong>数据持久化</strong>：etcd 默认数据一更新就进行持久化。</p><p><strong>安全</strong>：etcd 支持SSL客户端安全认证。</p><p>最后，etcd作为一个年轻的项目，真正告诉迭代和开发中，这既是一个优点，也是一个缺点。优点是它的未来具有无限的可能性，缺点是无法得到大项目长时间使用的检验。然而，目前CoreOS、Kubernetes 和CloudFoundry等知名项目均在生产环境中使用了etcd，所以总的来说，etcd值得你去尝试。</p><h2 id="etcd架构" tabindex="-1">etcd架构 <a class="header-anchor" href="#etcd架构" aria-label="Permalink to &quot;etcd架构&quot;">​</a></h2><p><img src="/assets/image-20200910212915543.BMbH-42m.png" alt="image-20200910212915543"></p><p>从etcd的架构图中我们可以看到，etcd主要分为四个部分</p><ul><li>HTTP Server：用于处理用户发送的API请求以及其他etcd节点的同步与心跳信息请求</li><li>Store：用于处理etcd支持的各类功能的事务，包括数据索引、节点状态变更、监控与反馈、事件处理与执行等等，是etcd对用户提供的大多数API功能的具体实现</li><li>Raft：Raft强一致性算法的具体实现，是etcd的核心</li><li>WAL：Write Ahead Log（预写式日志），是etcd的数据存储方式。除了在内存中存有所有数据的状态以及节点的索引以外，etcd就通过WAL进行持久化存储。WAL中，所有的数据提交前都会实现记录日志。Snapshot是为了防止数据过多而进行的状态快照；Entry表示存储的具体日志内容。</li></ul><h3 id="etcd集群" tabindex="-1">etcd集群 <a class="header-anchor" href="#etcd集群" aria-label="Permalink to &quot;etcd集群&quot;">​</a></h3><p>etcd作为一个高可用键值存储系统，天生就是为集群化而设计的，由于Raft算法在做决策时需要多数节点投票，所以etcd一般部署集群推荐奇数个节点，推荐的数量为3、5或者7个节点构成一个集群。</p><h2 id="搭建一个3节点集群示例" tabindex="-1">搭建一个3节点集群示例 <a class="header-anchor" href="#搭建一个3节点集群示例" aria-label="Permalink to &quot;搭建一个3节点集群示例&quot;">​</a></h2><p>在每个etcd节点指定集群成员，为了区分不同的集群最好同时配置一个独一无二的token。</p><p>下面是提前定义好的集群信息，其中n1、n2和n3表示3个不同的etcd节点。</p><p><img src="/assets/image-20200910215834659.pgY3tilS.png" alt="image-20200910215834659"></p><p>在n1这台机器上执行以下命令来启动etcd：</p><p><img src="/assets/image-20200910220236723.DFquwK5p.png" alt="image-20200910220236723"></p><p>在n2这台机器上执行以下命令启动etcd：</p><p><img src="/assets/image-20200910220304923.C5Yd2qei.png" alt="image-20200910220304923"></p><p>在n3这台机器上执行以下命令启动etcd：</p><p><img src="/assets/image-20200910220323979.DQJfcWhs.png" alt="image-20200910220323979"></p><p>etcd官网提供了一个公网访问的etcd存储地址，你可以通过如下命令得到etcd服务的目录，并把它作为-discovery参数使用</p><h2 id="etcd部署" tabindex="-1">etcd部署 <a class="header-anchor" href="#etcd部署" aria-label="Permalink to &quot;etcd部署&quot;">​</a></h2><h3 id="下载" tabindex="-1">下载 <a class="header-anchor" href="#下载" aria-label="Permalink to &quot;下载&quot;">​</a></h3><p>找到对应的 <strong>Github官网</strong>，到相应的releases，找到windows平台的压缩包进行下载</p><p><img src="/assets/image-20200911084346199.Cx9Cw8Z5.png" alt="image-20200911084346199"></p><p>解压完成后的目录</p><p><img src="/assets/image-20200911084441272.B_UqhA9r.png" alt="image-20200911084441272"></p><h3 id="启动" tabindex="-1">启动 <a class="header-anchor" href="#启动" aria-label="Permalink to &quot;启动&quot;">​</a></h3><p>双击etcd.exe就是启动了etcd。其它平台解压之后在bin目录下找etcd可执行文件。</p><p>默认会在2379端口监听客户端通信，在2380端口监听节点间的通信。</p><p><img src="/assets/image-20200911084639443.DSphuBaN.png" alt="image-20200911084639443"></p><p>etcdctl.ext可以理解为一个客户端或者本机etcd的控制端</p><h3 id="连接" tabindex="-1">连接 <a class="header-anchor" href="#连接" aria-label="Permalink to &quot;连接&quot;">​</a></h3><p>默认的etcdctrl使用的是v2版本的命令，我们需要设置环境变量ETCDCTL_API=3来使用v3版本的API，而默认的也就是环境变量为ETCDCTL_API=2是使用v2版本的API</p><p>修改环境变量指定使用API的版本</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SET_ETCDCTL_API</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">3</span></span></code></pre></div><h3 id="简单使用" tabindex="-1">简单使用 <a class="header-anchor" href="#简单使用" aria-label="Permalink to &quot;简单使用&quot;">​</a></h3><h4 id="put-设置" tabindex="-1">put：设置 <a class="header-anchor" href="#put-设置" aria-label="Permalink to &quot;put：设置&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">etcdctl.exe</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --endpoints=http://127.0.0.1:2379</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> put</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> baodelu</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;dsb&quot;</span></span></code></pre></div><p><img src="data:image/png;base64,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" alt="image-20200911085617469"></p><p>显示设置成功~</p><h4 id="get-获取" tabindex="-1">get：获取 <a class="header-anchor" href="#get-获取" aria-label="Permalink to &quot;get：获取&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">etcdctl.exe</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --endpoints=http://127.0.0.1:2379</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> baodelu</span></span></code></pre></div><h4 id="del-删除" tabindex="-1">del：删除 <a class="header-anchor" href="#del-删除" aria-label="Permalink to &quot;del：删除&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">etcdctl.exe</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --endpoints=http://127.0.0.1:2379</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> del</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> baodelu</span></span></code></pre></div><h2 id="go操作etcd" tabindex="-1">Go操作etcd <a class="header-anchor" href="#go操作etcd" aria-label="Permalink to &quot;Go操作etcd&quot;">​</a></h2><h3 id="安装依赖" tabindex="-1">安装依赖 <a class="header-anchor" href="#安装依赖" aria-label="Permalink to &quot;安装依赖&quot;">​</a></h3><p>这里使用官方的 etcd/clientv3包来连接etcd并进行相关操作</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> go.etcd.io/etcd/clientv3</span></span></code></pre></div><h3 id="put和get操作" tabindex="-1">put和get操作 <a class="header-anchor" href="#put和get操作" aria-label="Permalink to &quot;put和get操作&quot;">​</a></h3><p>put命令用来设置键值对数据，get命令用来根据key获取值</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fmt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go.etcd.io/etcd/clientv3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	cli, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clientv3.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">New</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(clientv3.Config {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		Endpoints: []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:2379&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// etcd的节点，可以传入多个</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		DialTimeout: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">time.Second, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 连接超时时间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;connect to etcd failed, err: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%v</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;connect to etcd success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 延迟关闭</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	defer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cli.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// put操作  设置1秒超时</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	ctx, cancel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WithTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Background</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), time.Second)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	_, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cli.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;moxi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lalala&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	cancel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;put to etcd failed, err:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%v</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// get操作，设置1秒超时</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	ctx, cancel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WithTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Background</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), time.Second)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	resp, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cli.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;q1mi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	cancel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;get from etcd failed, err:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%v</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="错误实例" tabindex="-1">错误实例 <a class="header-anchor" href="#错误实例" aria-label="Permalink to &quot;错误实例&quot;">​</a></h3><p>在我们运行代码的时候，突然出错了，undefined: resolver.BuildOption</p><p>经过排查，是因为 google.golang.org/grpc 1.26后的版本不支持clientv3的</p><p>所以我们只能将其改成1.26版本的就可以了，具体操作需要在go.mod上加上以下代码</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> google.golang.org/grpc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> google.golang.org/grpc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.26.0</span></span></code></pre></div><p><img src="/assets/image-20200911092218954.dyeZlqkz.png" alt="image-20200911092218954"></p><h3 id="watch" tabindex="-1">watch <a class="header-anchor" href="#watch" aria-label="Permalink to &quot;watch&quot;">​</a></h3><p>使用watch可以做服务的热更新</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fmt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go.etcd.io/etcd/clientv3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// etcd 的watch操作</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	cli, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clientv3.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">New</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(clientv3.Config {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		Endpoints: []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:2379&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// etcd的节点，可以传入多个</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		DialTimeout: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">time.Second, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 连接超时时间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;connect to etcd failed, err: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%v</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;connect to etcd success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	defer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cli.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// watch</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 派一个哨兵，一直监视着 moxi 这个key的变化（新增，修改，删除），返回一个只读的chan</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	ch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cli.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Watch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Background</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;moxi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 从通道中尝试获取值（监视的信息）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wresp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ch{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, evt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wresp.Events{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Type:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> value:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%v</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, evt.Type, evt.Kv.Key, evt.Kv.Value)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>然后我们往etcd中插入数据的时候</p><p><img src="data:image/png;base64,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" alt="image-20200911115618754"></p><p>我们的代码就会监听到数据的变化</p><p><img src="/assets/image-20200911115648301.qfj-vZR1.png" alt="image-20200911115648301"></p><h2 id="使用etcd优化日志项目" tabindex="-1">使用etcd优化日志项目 <a class="header-anchor" href="#使用etcd优化日志项目" aria-label="Permalink to &quot;使用etcd优化日志项目&quot;">​</a></h2><h2 id="logagent根据etcd的配置创建多个tailtask" tabindex="-1">logagent根据etcd的配置创建多个tailtask <a class="header-anchor" href="#logagent根据etcd的配置创建多个tailtask" aria-label="Permalink to &quot;logagent根据etcd的配置创建多个tailtask&quot;">​</a></h2><p><strong>见代码部分 18_LogAgent</strong></p><p>etcd底层如何实现watch给客户端发通知（websocket）</p><h2 id="logagent根据ip拉取配置" tabindex="-1">logagent根据IP拉取配置 <a class="header-anchor" href="#logagent根据ip拉取配置" aria-label="Permalink to &quot;logagent根据IP拉取配置&quot;">​</a></h2></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-d4a0bba5><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-d4a0bba5><span class="visually-hidden" id="doc-footer-aria-label" data-v-d4a0bba5>Pager</span><div class="pager" data-v-d4a0bba5><!----></div><div class="pager" data-v-d4a0bba5><a class="VPLink link pager-link next" href="/Golang%E8%BF%9B%E9%98%B6/04_Golang%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/README.html" data-v-d4a0bba5><!--[--><span class="desc" data-v-d4a0bba5>Next page</span><span class="title" data-v-d4a0bba5>04_Golang并发编程</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"gin框架_readme.md\":\"CqNtmIPh\",\"golang基础_04_go的运算符_readme.md\":\"BQ50tlQZ\",\"golang基础_02_go的变量_readme.md\":\"BXyQ5wJA\",\"golang基础_0_go语言的安装_readme.md\":\"DPhb2Cop\",\"golang进阶_21_kibana介绍和使用_readme.md\":\"Br4fLQkh\",\"golang进阶_07_日志库_readme.md\":\"BTmGh3XX\",\"gin框架_3_gorm介绍和使用_readme.md\":\"DHMEXB7j\",\"golang进阶_04_golang并发编程_readme.md\":\"Bt84zYm0\",\"golang基础_05_go的流程控制_readme.md\":\"DCjduk1Y\",\"api-examples.md\":\"DeN92C2F\",\"golang基础_11_go中的指针_readme.md\":\"C3k8abBm\",\"golang基础_10_go中的日期函数_readme.md\":\"D_coaZJ7\",\"golang进阶_10_flag包的用法_readme.md\":\"BVSWByQ7\",\"markdown-examples.md\":\"Cayd0owu\",\"golang基础_14_go中的接口_readme.md\":\"u0TWAhDq\",\"golang进阶_22_prometheus和grafana介绍_readme.md\":\"D_C7YxJU\",\"golang基础_07_go的切片_readme.md\":\"ebEKHahm\",\"golang基础_09_go的函数_readme.md\":\"DfQlJ0i4\",\"golang基础_01_go语言发展简史_readme.md\":\"Ce0hmYGI\",\"golang基础_17_go中的文件和目录操作_readme.md\":\"2JaQ6oVj\",\"index.md\":\"DJGOpihr\",\"golang进阶_18_etcd介绍_readme.md\":\"DvD1AlY8\",\"golang基础_13_go中的包以及gomod_readme.md\":\"BaTJWmqJ\",\"golang基础_08_go的map_readme.md\":\"B1aV1Y7t\",\"golang基础_16_golang中的反射_readme.md\":\"C_TzUV-3\",\"golang进阶_05_互联网协议介绍_readme.md\":\"Cx1LRr5M\",\"golang基础_15_goroutine实现并行和并发_readme.md\":\"DA4hEtiD\",\"golang进阶_06_http请求_readme.md\":\"CYu1FJTG\",\"golang基础_12_go中的结构体_readme.md\":\"DPuaMVSu\",\"golang进阶_12_sqlx库的使用_readme.md\":\"DX-fqHB6\",\"golang进阶_08_反射_readme.md\":\"DVVoLHUf\",\"golang进阶_15_go的依赖管理gomodule_readme.md\":\"CXy_-7To\",\"golang进阶_20_kafka消费示例_readme.md\":\"C21Eg77W\",\"golang进阶_19_es介绍和使用_readme.md\":\"BUGCXy3a\",\"golang基础_06_go的数组_readme.md\":\"CZE9VsJ3\",\"golang基础_03_go的数据类型_readme.md\":\"C0Y0RnHT\",\"golang进阶_13_go操作redis_readme.md\":\"COshZ5Xn\",\"golang进阶_11_go操作数据库_readme.md\":\"DW7VIefe\",\"golang进阶_14_go操作消息队列_readme.md\":\"BQGbE0zh\",\"gin框架_4_gorm进行curd_readme.md\":\"RE3_KG-6\",\"gin框架_2_http及template介绍_readme.md\":\"CQGpAn0J\",\"golang进阶_16_gocontext的使用_readme.md\":\"xGlcXHSI\",\"golang进阶_17_日志收集项目架构设计及kafka介绍_readme.md\":\"q7Lubki6\",\"gin框架_1_gin内容介绍_readme.md\":\"DYlhIdnx\",\"golang进阶_09_单元测试_readme.md\":\"Bd7KyYK9\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Go Docs\",\"description\":\"Go Docs\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Golang基础\",\"link\":\"Golang基础/01_Go语言发展简史/README\"},{\"text\":\"Golang进阶\",\"link\":\"Golang进阶/04_Golang并发编程/README\"},{\"text\":\"Gin框架\",\"link\":\"Gin框架/1_Gin内容介绍/README\"}],\"sidebar\":{\"markdown-examples\":[{\"text\":\"Examples\",\"items\":[{\"text\":\"Markdown Examples\",\"link\":\"/markdown-examples\"},{\"text\":\"Runtime API Examples\",\"link\":\"/api-examples\"}]}],\"Golang基础\":[{\"text\":\"Golang基础\",\"items\":[{\"text\":\"01_Go语言发展简史\",\"link\":\"Golang基础/01_Go语言发展简史/README\"},{\"text\":\"02_Go的变量\",\"link\":\"Golang基础/02_Go的变量/README\"},{\"text\":\"03_Go的数据类型\",\"link\":\"Golang基础/03_Go的数据类型/README\"},{\"text\":\"04_Go的运算符\",\"link\":\"Golang基础/04_Go的运算符/README\"},{\"text\":\"05_Go的流程控制\",\"link\":\"Golang基础/05_Go的流程控制/README\"},{\"text\":\"06_Go的数组\",\"link\":\"Golang基础/06_Go的数组/README\"},{\"text\":\"07_Go的切片\",\"link\":\"Golang基础/07_Go的切片/README\"},{\"text\":\"08_Go的map\",\"link\":\"Golang基础/08_Go的map/README\"},{\"text\":\"09_Go的函数\",\"link\":\"Golang基础/09_Go的函数/README\"},{\"text\":\"0_Go语言的安装\",\"link\":\"Golang基础/0_Go语言的安装/README\"},{\"text\":\"10_Go中的日期函数\",\"link\":\"Golang基础/10_Go中的日期函数/README\"},{\"text\":\"11_Go中的指针\",\"link\":\"Golang基础/11_Go中的指针/README\"},{\"text\":\"12_Go中的结构体\",\"link\":\"Golang基础/12_Go中的结构体/README\"},{\"text\":\"13_Go中的包以及GoMod\",\"link\":\"Golang基础/13_Go中的包以及GoMod/README\"},{\"text\":\"14_Go中的接口\",\"link\":\"Golang基础/14_Go中的接口/README\"},{\"text\":\"15_goroutine实现并行和并发\",\"link\":\"Golang基础/15_goroutine实现并行和并发/README\"},{\"text\":\"16_Golang中的反射\",\"link\":\"Golang基础/16_Golang中的反射/README\"},{\"text\":\"17_Go中的文件和目录操作\",\"link\":\"Golang基础/17_Go中的文件和目录操作/README\"}]}],\"Golang进阶\":[{\"text\":\"Golang进阶\",\"items\":[{\"text\":\"04_Golang并发编程\",\"link\":\"Golang进阶/04_Golang并发编程/README\"},{\"text\":\"05_互联网协议介绍\",\"link\":\"Golang进阶/05_互联网协议介绍/README\"},{\"text\":\"06_HTTP请求\",\"link\":\"Golang进阶/06_HTTP请求/README\"},{\"text\":\"07_日志库\",\"link\":\"Golang进阶/07_日志库/README\"},{\"text\":\"08_反射\",\"link\":\"Golang进阶/08_反射/README\"},{\"text\":\"09_单元测试\",\"link\":\"Golang进阶/09_单元测试/README\"},{\"text\":\"10_Flag包的用法\",\"link\":\"Golang进阶/10_Flag包的用法/README\"},{\"text\":\"11_Go操作数据库\",\"link\":\"Golang进阶/11_Go操作数据库/README\"},{\"text\":\"12_sqlx库的使用\",\"link\":\"Golang进阶/12_sqlx库的使用/README\"},{\"text\":\"13_Go操作Redis\",\"link\":\"Golang进阶/13_Go操作Redis/README\"},{\"text\":\"14_Go操作消息队列\",\"link\":\"Golang进阶/14_Go操作消息队列/README\"},{\"text\":\"15_Go的依赖管理GoModule\",\"link\":\"Golang进阶/15_Go的依赖管理GoModule/README\"},{\"text\":\"16_GoContext的使用\",\"link\":\"Golang进阶/16_GoContext的使用/README\"},{\"text\":\"17_日志收集项目架构设计及Kafka介绍\",\"link\":\"Golang进阶/17_日志收集项目架构设计及Kafka介绍/README\"},{\"text\":\"18_etcd介绍\",\"link\":\"Golang进阶/18_etcd介绍/README\"},{\"text\":\"19_ES介绍和使用\",\"link\":\"Golang进阶/19_ES介绍和使用/README\"},{\"text\":\"20_Kafka消费示例\",\"link\":\"Golang进阶/20_Kafka消费示例/README\"},{\"text\":\"21_Kibana介绍和使用\",\"link\":\"Golang进阶/21_Kibana介绍和使用/README\"},{\"text\":\"22_Prometheus和Grafana介绍\",\"link\":\"Golang进阶/22_Prometheus和Grafana介绍/README\"}]}],\"Gin框架\":[{\"text\":\"Gin框架\",\"items\":[{\"text\":\"1_Gin内容介绍\",\"link\":\"Gin框架/1_Gin内容介绍/README\"},{\"text\":\"2_http及Template介绍\",\"link\":\"Gin框架/2_http及Template介绍/README\"},{\"text\":\"3_GORM介绍和使用\",\"link\":\"Gin框架/3_GORM介绍和使用/README\"},{\"text\":\"4_GORM进行CURD\",\"link\":\"Gin框架/4_GORM进行CURD/README\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>